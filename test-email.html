<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const btn = document.getElementById('send');

    btn.addEventListener('click', async () => {
      btn.disabled = true; btn.textContent = 'Envoi...';

      // ⚠️ Paramètres envoyés — couvre 99% des templates
      const params = {
        puzzle_id: '1',
        puzzle_title: 'Clé du Portail',
        timestamp: new Date().toISOString(),
        user_agent: navigator.userAgent,

        // destinataire & meta (même si ton template a déjà To Email)
        to_email: 'gernez.pierre@gmail.com',
        from_name: 'Jeu des 7 clés',
        reply_to: 'no-reply@pierrotwister.github.io'
      };

      try {
        // ✅ Public Key passée en 4e argument (pas besoin de emailjs.init)
        const res = await emailjs.send(
          'service_45nppfp',     // Service ID EXACT
          'template_m49xxnx',    // Template ID EXACT (corrigé)
          params,
          'QxrbnTrOdkevpQR0h'    // ⚠️ TA PUBLIC KEY
        );
        alert('✅ Email envoyé !');
        console.log(res);
      } catch (err) {
        alert('❌ Erreur d’envoi (voir console)');
        console.error('EmailJS error:', err);
        if (err?.status || err?.text) console.error('Status:', err.status, 'Text:', err.text);
      } finally {
        btn.disabled = false; btn.textContent = 'Envoyer un email test';
      }
    });
  });
</script>
